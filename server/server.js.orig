var configEnvironments = require('./config/config');

var request = require('request');

var env = process.env.NODE_ENV || 'development';
var config = configEnvironments(env, request);

<<<<<<< HEAD
var app = require('./app')(config);
=======
// Routes for API
var apiRouter = express.Router();
if (config.passport) {
  apiRouter.use(authMiddleware.errorCode);
}

//apiRouter.use(delayMiddleware(config));

require('./routes/api')(apiRouter, config, request);
app.use('/', apiRouter);

// Error handling
app.use(function (err, req, res, next) {
  //Only print stacktrace when in a dev environment
  var stackTrace = {};
  if (config.showErrors) {
    stackTrace = err;
  }

  console.error(err);
  res.status(500).send({
    status: 500,
    message: err.message,
    error: stackTrace,
    type: 'internal'
  });
});
>>>>>>> feature/graphs

// Start server
app.listen(config.app.port, function () {
  console.log('--' + config.app.name + ' API available on port ' + config.app.port);
});
